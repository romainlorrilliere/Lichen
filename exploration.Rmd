---
title: "**Exploration des données LichenGo**"
author: "Laure & Romain"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
    fig_height: 12
    fig_width: 16
    toc: yes
    toc_depth: 3
    toc_float:
      collapsed: true
      smooth_scroll: false
    number_sections: true
    code_folding: hide
pdf_document:
  toc: yes
  toc_depth: '1'
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE)
```

# Initialisation

Installation des packages
```{r install packages}
source("fun_exploration.r")
library(data.table)
library(dplyr)
library(ggplot2)
library(kableExtra)
library(knitr)
library(sf)
```


Fonction locale

```{r fun_loc}

my_kable_print <- function(d,caption="",bootstrap_options = "hover",position="center" , font_size=11,full_width = FALSE,fixed_thead = TRUE,scroll=TRUE,scroll_height = "300px", scroll_width = "100%") {
    
    k <- kable_styling(kable(d,caption = caption),bootstrap_options = ,bootstrap_options, full_width = full_width,fixed_thead = fixed_thead, position=position,font_size=font_size)
    if(scroll) 
        k <- scroll_box(k,width = scroll_width, height = scroll_height)
   
    return(k)
}

```


# Les données 


```{r read}
data <- fread("data/data_lichen_rhone_grandest.csv")

data <- subset(data,region=="Rhone")
dloc <- unique(data[,c("site_id","site_code","lon_l93","lat_l93")])
dloc$lon_l93 <- as.numeric(dloc$lon_l93)
dloc$lat_l93 <- as.numeric(dloc$lat_l93)



polluant <- read.csv2("data/coordonnees_stations_atmoAURA_2.csv",header=TRUE,blank.lines.skip=TRUE)
polluant <- subset(polluant,!(is.na(altitude)))
polluant$coord_y_l93 <- as.numeric(as.character(polluant$coord_y_l93))
polluant$coord_x_l93 <- as.numeric(as.character(polluant$coord_y_l93))


projcrs <- "+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs" #Lambert 93

dloc.sf <- st_as_sf(dloc,coords = c("lon_l93", "lat_l93"), crs = projcrs)
dpol.sf <- st_as_sf(polluant,coords = c("coord_y_l93","coord_x_l93"),crs=projcrs)





```






```{r carto1}


gg <- ggplot() + geom_sf(data=dloc.sf,colour="green") + geom_sf(data=dpol.sf,colour="red")
print(gg)
		


```

# Calcul de distance

on estime les distances entre les arbres et la station la plus proche

```{r distance}

d_near <- st_nearest_feature(dloc.sf,dpol.sf)


```



